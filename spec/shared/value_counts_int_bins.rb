RSpec.shared_examples_for 'value_counts with an integer bins:' do
  let(:values) do
    [ 24, 24, 39, 43, 36, 50, 16, 29, 18, 23, 18, 29, 24, 17, 44, 24, 4, 14, 2,
      40, 23, 46, 24, 47, 2, 35, 40, 46, 19, 8, 12, 32, 7, 50, 29, 11, 20, 47,
      8, 45, 22, 23, 41, 16, 37, 35, 41, 6, 36, 16, 7, 40, 9, 23, 7, 17, 11,
      26, 27, 49, 17, 3, 3, 43, 44, 10, 17, 31, 16, 49, 46, 44, 16, 21, 27, 47,
      47, 37, 20, 41, 10, 30, 32, 24, 8, 34, 45, 6, 38, 39, 15, 8, 16, 25, 28,
      21, 2, 24, 21, 22 ]
  end

  matrix = [
    { normalize: false, sort: true,  ascending: false, dropna: true, bins: 5,
      result: {
        (15.714 ... 22.571) => 20,
        (22.571 ... 29.429) => 19,
        (43.143 ... 50.048) => 16,
        ( 2.0   ...  8.857) => 15,
        (36.286 ... 43.143) => 13,
        (29.429 ... 36.286) =>  9,
        ( 8.857 ... 15.714) =>  8,
      } },
    { normalize: false, sort: true,  ascending: false, dropna: false, bins: 5,
      result: {
        (15.714 ... 22.571) => 20,
        (22.571 ... 29.429) => 19,
        (43.143 ... 50.048) => 16,
        ( 2.0   ...  8.857) => 15,
        (36.286 ... 43.143) => 13,
        (29.429 ... 36.286) =>  9,
        ( 8.857 ... 15.714) =>  8,
      } },

    { normalize: false, sort: true,  ascending: true, dropna: true, bins: 5,
      result: {
        ( 8.857 ... 15.714) =>  8,
        (29.429 ... 36.286) =>  9,
        (36.286 ... 43.143) => 13,
        ( 2.0   ...  8.857) => 15,
        (43.143 ... 50.048) => 16,
        (22.571 ... 29.429) => 19,
        (15.714 ... 22.571) => 20,
      } },
    { normalize: false, sort: true,  ascending: true, dropna: false, bins: 5,
      result: {
        ( 8.857 ... 15.714) =>  8,
        (29.429 ... 36.286) =>  9,
        (36.286 ... 43.143) => 13,
        ( 2.0   ...  8.857) => 15,
        (43.143 ... 50.048) => 16,
        (22.571 ... 29.429) => 19,
        (15.714 ... 22.571) => 20,
      } },

    { normalize: false, sort: false,  ascending: false, dropna: true, bins: 5,
      result: {
        ( 2.0   ...  8.857) => 15,
        ( 8.857 ... 15.714) =>  8,
        (15.714 ... 22.571) => 20,
        (22.571 ... 29.429) => 19,
        (29.429 ... 36.286) =>  9,
        (36.286 ... 43.143) => 13,
        (43.143 ... 50.048) => 16,
      } },
    { normalize: false, sort: false,  ascending: false, dropna: false, bins: 5,
      result: {
        ( 2.0   ...  8.857) => 15,
        ( 8.857 ... 15.714) =>  8,
        (15.714 ... 22.571) => 20,
        (22.571 ... 29.429) => 19,
        (29.429 ... 36.286) =>  9,
        (36.286 ... 43.143) => 13,
        (43.143 ... 50.048) => 16,
      } },

    { normalize: false, sort: false,  ascending: true, dropna: true, bins: 5,
      result: {
        ( 2.0   ...  8.857) => 15,
        ( 8.857 ... 15.714) =>  8,
        (15.714 ... 22.571) => 20,
        (22.571 ... 29.429) => 19,
        (29.429 ... 36.286) =>  9,
        (36.286 ... 43.143) => 13,
        (43.143 ... 50.048) => 16,
      } },
    { normalize: false, sort: false,  ascending: true, dropna: false, bins: 5,
      result: {
        ( 2.0   ...  8.857) => 15,
        ( 8.857 ... 15.714) =>  8,
        (15.714 ... 22.571) => 20,
        (22.571 ... 29.429) => 19,
        (29.429 ... 36.286) =>  9,
        (36.286 ... 43.143) => 13,
        (43.143 ... 50.048) => 16,
      } },

    { normalize: true, sort: true,  ascending: false, dropna: true, bins: 5,
      result: {
        (15.714 ... 22.571) => 0.20,
        (22.571 ... 29.429) => 0.19,
        (43.143 ... 50.048) => 0.16,
        ( 2.0   ...  8.857) => 0.15,
        (36.286 ... 43.143) => 0.13,
        (29.429 ... 36.286) => 0.09,
        ( 8.857 ... 15.714) => 0.08,
      } },
    { normalize: true, sort: true,  ascending: false, dropna: false, bins: 5,
      result: {
        (15.714 ... 22.571) => 0.20,
        (22.571 ... 29.429) => 0.19,
        (43.143 ... 50.048) => 0.16,
        ( 2.0   ...  8.857) => 0.15,
        (36.286 ... 43.143) => 0.13,
        (29.429 ... 36.286) => 0.09,
        ( 8.857 ... 15.714) => 0.08,
      } },

    { normalize: true, sort: true,  ascending: true, dropna: true, bins: 5,
      result: {
        ( 8.857 ... 15.714) => 0.08,
        (29.429 ... 36.286) => 0.09,
        (36.286 ... 43.143) => 0.13,
        ( 2.0   ...  8.857) => 0.15,
        (43.143 ... 50.048) => 0.16,
        (22.571 ... 29.429) => 0.19,
        (15.714 ... 22.571) => 0.20,
      } },
    { normalize: true, sort: true,  ascending: true, dropna: false, bins: 5,
      result: {
        ( 8.857 ... 15.714) => 0.08,
        (29.429 ... 36.286) => 0.09,
        (36.286 ... 43.143) => 0.13,
        ( 2.0   ...  8.857) => 0.15,
        (43.143 ... 50.048) => 0.16,
        (22.571 ... 29.429) => 0.19,
        (15.714 ... 22.571) => 0.20,
      } },

    { normalize: true, sort: false,  ascending: false, dropna: true, bins: 5,
      result: {
        ( 2.0   ...  8.857) => 0.15,
        ( 8.857 ... 15.714) => 0.08,
        (15.714 ... 22.571) => 0.20,
        (22.571 ... 29.429) => 0.19,
        (29.429 ... 36.286) => 0.09,
        (36.286 ... 43.143) => 0.13,
        (43.143 ... 50.048) => 0.16,
      } },
    { normalize: true, sort: false,  ascending: false, dropna: false, bins: 5,
      result: {
        ( 2.0   ...  8.857) => 0.15,
        ( 8.857 ... 15.714) => 0.08,
        (15.714 ... 22.571) => 0.20,
        (22.571 ... 29.429) => 0.19,
        (29.429 ... 36.286) => 0.09,
        (36.286 ... 43.143) => 0.13,
        (43.143 ... 50.048) => 0.16,
      } },

    { normalize: true, sort: false,  ascending: true, dropna: true, bins: 5,
      result: {
        ( 2.0   ...  8.857) => 0.15,
        ( 8.857 ... 15.714) => 0.08,
        (15.714 ... 22.571) => 0.20,
        (22.571 ... 29.429) => 0.19,
        (29.429 ... 36.286) => 0.09,
        (36.286 ... 43.143) => 0.13,
        (43.143 ... 50.048) => 0.16,
      } },
    { normalize: true, sort: false,  ascending: true, dropna: false, bins: 5,
      result: {
        ( 2.0   ...  8.857) => 0.15,
        ( 8.857 ... 15.714) => 0.08,
        (15.714 ... 22.571) => 0.20,
        (22.571 ... 29.429) => 0.19,
        (29.429 ... 36.286) => 0.09,
        (36.286 ... 43.143) => 0.13,
        (43.143 ... 50.048) => 0.16,
      } },
  ]

  matrix.each do |params|
    param_values = params.values_at(:normalize, :sort, :ascending, :dropna, :bins)
    context "with normalize: %s, sort: %s, ascending: %s, dropna: %s, bins: %s" % param_values do
      specify do
        params = params.dup
        expected_result = params.delete(:result)
        expect(receiver.value_counts(**params).to_a).to eq(expected_result.to_a)
      end
    end
  end
end
